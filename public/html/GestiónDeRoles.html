<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gestión de Roles</title>
  <link rel="shortcut icon" type="image/png" href="../assets/images/logos/favicon.png" />
  <link rel="stylesheet" href="../assets/css/styles.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/themify-icons/0.1.2/css/themify-icons.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <link rel="stylesheet" href="../assets/css/GestionRoles.css">
</head>

<body>
  <!-- Body Wrapper -->
  <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
    data-sidebar-position="fixed" data-header-position="fixed">

    <!-- Sidebar Start -->
    <aside class="left-sidebar">
      <!-- Sidebar scroll-->
      <div>
        <div class="brand-logo d-flex align-items-center justify-content-between">
          <a href="./index.html" class="text-nowrap logo-img">
            <img src="../assets/images/logos/dark-logo.svg" width="180" alt="" />
          </a>
          <div class="close-btn d-xl-none d-block sidebartoggler cursor-pointer" id="sidebarCollapse">
            <i class="ti ti-x fs-8"></i>
          </div>
        </div>
        <!-- Sidebar navigation-->
        <nav class="sidebar-nav scroll-sidebar" data-simplebar="">
          <ul id="sidebarnav">
            <li class="nav-small-cap">
              <i class="ti ti-menu-2 nav-small-cap-icon fs-4"></i>
              <span class="hide-menu">Menu Principal</span>
            </li>
        
            <li class="sidebar-item">
              <a class="sidebar-link" href="index.html">
                <span>
                  <i class="ti ti-home"></i>
                </span>
                <span class="hide-menu">Inicio</span>
              </a>
            </li>
            <li><hr /></li>
        
            <!-- Dashboard -->
            <li class="sidebar-item">
              <a class="sidebar-link has-arrow" href="#dashboardSubmenu" data-bs-toggle="collapse" aria-expanded="false">
                <span>
                  <i class="ti ti-dashboard"></i>
                </span>
                <span class="hide-menu">Dashboard</span>
              </a>
              <ul id="dashboardSubmenu" class="collapse first-level">
                <li class="sidebar-item">
                  <a href="GestionDesempeno.html" class="sidebar-link">
                    <i class="ti ti-chart-bar"></i>
                    <span class="hide-menu">Gestión De Desempeño</span>
                  </a>
                </li>
              </ul>
            </li>
            <li><hr /></li>
        
            <!-- Configuración -->
            <li class="sidebar-item">
              <a class="sidebar-link has-arrow" href="#configSubmenu" data-bs-toggle="collapse" aria-expanded="false">
                <span>
                  <i class="ti ti-settings"></i>
                </span>
                <span class="hide-menu">Configuración</span>
              </a>
              <ul id="configSubmenu" class="collapse first-level">
                <li class="sidebar-item">
                  <a href="GestiónDeRoles.html" class="sidebar-link">
                    <i class="ti ti-user-check"></i>
                    <span class="hide-menu">Gestión De Roles</span>
                  </a>
                </li>
              </ul>
            </li>
            <li><hr /></li>
        
            <!-- Usuarios -->
            <li class="sidebar-item">
              <a class="sidebar-link has-arrow" href="#userSubmenu" data-bs-toggle="collapse" aria-expanded="false">
                <span>
                  <i class="ti ti-users"></i>
                </span>
                <span class="hide-menu">Usuarios</span>
              </a>
              <ul id="userSubmenu" class="collapse first-level">
                <li class="sidebar-item">
                  <a href="GestiónDeUsuarios.html" class="sidebar-link">
                    <i class="ti ti-user-plus"></i>
                    <span class="hide-menu">Gestión De Usuarios</span>
                  </a>
                </li>
                <li class="sidebar-item">
                  <a href="GestiónDeAcceso.html" class="sidebar-link">
                    <i class="ti ti-lock"></i>
                    <span class="hide-menu">Gestión De Acceso</span>
                  </a>
                </li>
              </ul>
            </li>
            <li><hr /></li>
        
            <!-- Categorías -->
            <li class="sidebar-item">
              <a class="sidebar-link has-arrow" href="#categoriasSubmenu" data-bs-toggle="collapse" aria-expanded="false">
                <span>
                  <i class="ti ti-category"></i>
                </span>
                <span class="hide-menu">Categorías</span>
              </a>
              <ul id="categoriasSubmenu" class="collapse first-level">
                <li class="sidebar-item">
                  <a href="CategoriasProductos.html" class="sidebar-link">
                    <i class="ti ti-box"></i>
                    <span class="hide-menu">Categorías De Productos</span>
                  </a>
                </li>
              </ul>
            </li>
            <li><hr /></li>
        
            <!-- Compras -->
            <li class="sidebar-item">
              <a class="sidebar-link has-arrow" href="#comprasSubmenu" data-bs-toggle="collapse" aria-expanded="false">
                <span>
                  <i class="ti ti-shopping-cart"></i>
                </span>
                <span class="hide-menu">Compras</span>
              </a>
              <ul id="comprasSubmenu" class="collapse first-level">
                <li class="sidebar-item">
                  <a href="GDeProductos.html" class="sidebar-link">
                    <i class="ti ti-package"></i>
                    <span class="hide-menu">Gestión De Productos</span>
                  </a>
                </li>
                <li class="sidebar-item">
                  <a href="GDeProveedores.html" class="sidebar-link">
                    <i class="ti ti-truck-delivery"></i>
                    <span class="hide-menu">Gestión De Proveedores</span>
                  </a>
                </li>
                <li class="sidebar-item">
                  <a href="GDeCompras.html" class="sidebar-link">
                    <i class="ti ti-receipt"></i>
                    <span class="hide-menu">Gestión De Compras</span>
                  </a>
                </li>
              </ul>
            </li>
            <li><hr /></li>
        
            <!-- Ventas -->
            <li class="sidebar-item">
              <a class="sidebar-link has-arrow" href="#ventasSubmenu" data-bs-toggle="collapse" aria-expanded="false">
                <span>
                  <i class="ti ti-cash"></i>
                </span>
                <span class="hide-menu">Ventas</span>
              </a>
              <ul id="ventasSubmenu" class="collapse first-level">
                <li class="sidebar-item">
                  <a href="GDeClientes.html" class="sidebar-link">
                    <i class="ti ti-user-circle"></i>
                    <span class="hide-menu">Gestión De Clientes</span>
                  </a>
                </li>
                <li class="sidebar-item">
                  <a href="GDePedidos.html" class="sidebar-link">
                    <i class="ti ti-clipboard-list"></i>
                    <span class="hide-menu">Gestión De Pedidos</span>
                  </a>
                </li>
                <li class="sidebar-item">
                  <a href="GDeVentas.html" class="sidebar-link">
                    <i class="ti ti-report-money"></i>
                    <span class="hide-menu">Gestión De Ventas</span>
                  </a>
                </li>
                <li class="sidebar-item">
                  <a href="GDeDevoluciones2.html" class="sidebar-link">
                    <i class="ti ti-arrow-back-up"></i>
                    <span class="hide-menu">Devoluciones</span>
                  </a>
                </li>
                <li class="sidebar-item">
                  <a href="GDeDevoluciones2.html" class="sidebar-link">
                    <i class="ti ti-exchange"></i>
                    <span class="hide-menu">Devoluciones2</span>
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </nav>
        <!-- End Sidebar navigation -->
      </div>
      <!-- End Sidebar scroll-->
    </aside>
    <!-- Sidebar End -->

    <!-- Main Wrapper -->
    <div class="body-wrapper">

      <!-- Header Start -->
      <!-- (Header code unchanged) -->
      <!-- Header End -->

      <div class="container-fluid">
        <!-- Row 1 -->
        <div class="container mt-5">
          <h2>Gestión de Roles</h2>
          <button class="btn btn-success mb-4" onclick="downloadExcel()">Descargar Excel</button>

          <!-- Formulario para Crear/Modificar Roles -->
          <div class="card mb-4">
            <div class="card-header"></div>
            <div class="card-body">
              <form id="roleForm">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="roleName" class="form-label">Nombre del Rol</label>
                    <input type="text" class="form-control" id="roleName" placeholder="Ingrese el nombre del rol" required>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="roleState" class="form-label">Estado del Rol</label>
                    <select class="form-control" id="roleState" required>
                      <option value="activo">Activo</option>
                      <option value="inactivo">Inactivo</option>
                    </select>
                  </div>
                </div>

                <div class="container mt-5">
                    <div id="rolePermissions" class="row">
                    <h2>Gestión de Permisos</h2>
                    <div class="mb-3">
                        <input type="text" id="search" class="form-control" placeholder="Buscar módulo o permiso">
                        <button type="button" id="searchBtn" class="btn btn-primary mt-2">Buscar</button>
                    </div>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Permiso/Módulo</th>
                                <th>Crear </th>
                                <th>Modificar </th>
                                <th>Cambiar estado</th>
                                <th>Ver</th>
                                <th>Eliminar </th>
                                <th>Listar </th>
                                <th>Buscar</th>
                                
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Configuración: Gestión de Roles</td>
                                <td><input type="checkbox" name="permiso" value="crearRol"></td>
                                <td><input type="checkbox" name="permiso" value="modificarRol"></td>
                                <td><input type="checkbox" name="permiso" value="cambiarEstadoRol"></td>
                                <td><input type="checkbox" name="permiso" value="visualizarDetallesRol"></td>
                                <td><input type="checkbox" name="permiso" value="eliminarRol"></td>
                                <td><input type="checkbox" name="permiso" value="listarRoles"></td>
                                <td><input type="checkbox" name="permiso" value="buscarRoles"></td>
                               
                            </tr>
                            <tr>
                                <td>Usuarios: Gestión de usuarios</td>
                                <td><input type="checkbox" name="permiso" value="crearRol"></td>
                                <td><input type="checkbox" name="permiso" value="modificarRol"></td>
                                <td><input type="checkbox" name="permiso" value="cambiarEstadoRol"></td>
                                <td><input type="checkbox" name="permiso" value="visualizarDetallesRol"></td>
                                <td><input type="checkbox" name="permiso" value="eliminarRol"></td>
                                <td><input type="checkbox" name="permiso" value="listarRoles"></td>
                                <td><input type="checkbox" name="permiso" value="buscarRoles"></td>
                            
                            </tr>
                            <tr>
                                <td>Usuarios: Gestión de acceso</td>
                                <td><input type="checkbox" name="permiso" value="crearRol"></td>
                                <td><input type="checkbox" name="permiso" value="modificarRol"></td>
                                <td><input type="checkbox" name="permiso" value="cambiarEstadoRol"></td>
                                <td><input type="checkbox" name="permiso" value="visualizarDetallesRol"></td>
                                <td><input type="checkbox" name="permiso" value="eliminarRol"></td>
                                <td><input type="checkbox" name="permiso" value="listarRoles"></td>
                                <td><input type="checkbox" name="permiso" value="buscarRoles"></td>
                              
                            </tr>
                            <tr>
                                <td>Compras: Gestión de productos</td>
                                <td><input type="checkbox" name="permiso" value="crearRol"></td>
                                <td><input type="checkbox" name="permiso" value="modificarRol"></td>
                                <td><input type="checkbox" name="permiso" value="cambiarEstadoRol"></td>
                                <td><input type="checkbox" name="permiso" value="visualizarDetallesRol"></td>
                                <td><input type="checkbox" name="permiso" value="eliminarRol"></td>
                                <td><input type="checkbox" name="permiso" value="listarRoles"></td>
                                <td><input type="checkbox" name="permiso" value="buscarRoles"></td>
                               
                            </tr>
                            <tr>
                                <td>Compras: Gestión de proveedores</td>
                                <td><input type="checkbox" name="permiso" value="crearRol"></td>
                                <td><input type="checkbox" name="permiso" value="modificarRol"></td>
                                <td><input type="checkbox" name="permiso" value="cambiarEstadoRol"></td>
                                <td><input type="checkbox" name="permiso" value="visualizarDetallesRol"></td>
                                <td><input type="checkbox" name="permiso" value="eliminarRol"></td>
                                <td><input type="checkbox" name="permiso" value="listarRoles"></td>
                                <td><input type="checkbox" name="permiso" value="buscarRoles"></td>
                               
                            </tr>
                            <tr>
                                <td>Compras: Gestión de compras</td>
                                <td><input type="checkbox" name="permiso" value="crearRol"></td>
                                <td><input type="checkbox" name="permiso" value="modificarRol"></td>
                                <td><input type="checkbox" name="permiso" value="cambiarEstadoRol"></td>
                                <td><input type="checkbox" name="permiso" value="visualizarDetallesRol"></td>
                                <td><input type="checkbox" name="permiso" value="eliminarRol"></td>
                                <td><input type="checkbox" name="permiso" value="listarRoles"></td>
                                <td><input type="checkbox" name="permiso" value="buscarRoles"></td>
                            
                            </tr>
                            <tr>
                                <td>Ventas: Gestión de clientes</td>
                                <td><input type="checkbox" name="permiso" value="crearRol"></td>
                                <td><input type="checkbox" name="permiso" value="modificarRol"></td>
                                <td><input type="checkbox" name="permiso" value="cambiarEstadoRol"></td>
                                <td><input type="checkbox" name="permiso" value="visualizarDetallesRol"></td>
                                <td><input type="checkbox" name="permiso" value="eliminarRol"></td>
                                <td><input type="checkbox" name="permiso" value="listarRoles"></td>
                                <td><input type="checkbox" name="permiso" value="buscarRoles"></td>
                             
                            </tr>
                            <tr>
                                <td>Ventas: Gestión carrito de productos</td>
                                <td><input type="checkbox" name="permiso" value="crearRol"></td>
                                <td><input type="checkbox" name="permiso" value="modificarRol"></td>
                                <td><input type="checkbox" name="permiso" value="cambiarEstadoRol"></td>
                                <td><input type="checkbox" name="permiso" value="visualizarDetallesRol"></td>
                                <td><input type="checkbox" name="permiso" value="eliminarRol"></td>
                                <td><input type="checkbox" name="permiso" value="listarRoles"></td>
                                <td><input type="checkbox" name="permiso" value="buscarRoles"></td>
                              
                            </tr>
                            <tr>
                                <td>Ventas: Gestión de pedidos</td>
                                <td><input type="checkbox" name="permiso" value="crearRol"></td>
                                <td><input type="checkbox" name="permiso" value="modificarRol"></td>
                                <td><input type="checkbox" name="permiso" value="cambiarEstadoRol"></td>
                                <td><input type="checkbox" name="permiso" value="visualizarDetallesRol"></td>
                                <td><input type="checkbox" name="permiso" value="eliminarRol"></td>
                                <td><input type="checkbox" name="permiso" value="listarRoles"></td>
                                <td><input type="checkbox" name="permiso" value="buscarRoles"></td>
                               
                            </tr>
                            <tr>
                                <td>Ventas: Gestión de ventas</td>
                                <td><input type="checkbox" name="permiso" value="crearRol"></td>
                                <td><input type="checkbox" name="permiso" value="modificarRol"></td>
                                <td><input type="checkbox" name="permiso" value="cambiarEstadoRol"></td>
                                <td><input type="checkbox" name="permiso" value="visualizarDetallesRol"></td>
                                <td><input type="checkbox" name="permiso" value="eliminarRol"></td>
                                <td><input type="checkbox" name="permiso" value="listarRoles"></td>
                                <td><input type="checkbox" name="permiso" value="buscarRoles"></td>
                              
                            </tr>
                            <tr>
                                <td>Ventas: Gestión de devoluciones</td>
                                <td><input type="checkbox" name="permiso" value="crearRol"></td>
                                <td><input type="checkbox" name="permiso" value="modificarRol"></td>
                                <td><input type="checkbox" name="permiso" value="cambiarEstadoRol"></td>
                                <td><input type="checkbox" name="permiso" value="visualizarDetallesRol"></td>
                                <td><input type="checkbox" name="permiso" value="eliminarRol"></td>
                                <td><input type="checkbox" name="permiso" value="listarRoles"></td>
                                <td><input type="checkbox" name="permiso" value="buscarRoles"></td>
                               
                            </tr>
                        </tbody>
                    </table>
                </div>
                </div>
                <div id="permissionsPagination">
                  <button id="prevPage" disabled>Anterior</button>
                  <span id="currentPage">1</span>/<span id="totalPages">2</span>
                  <button id="nextPage" disabled>Siguiente</button>
                </div>
                <br>
                <button type="submit" class="btn btn-primary" id="submitButton">Crear Rol</button>
                
          <!-- Lista de Roles -->
          <div class="card mb-4">
            <div class="card-header">Lista de Roles</div>
            <div class="card-body">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Nombre del Rol</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="rolesList">
                  <!-- Fila de ejemplo -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="../assets/js/libs/jquery.min.js"></script>
  <script src="../assets/js/libs/bootstrap.bundle.min.js"></script>
  <script src="../assets/js/libs/simplebar.min.js"></script>
  <script src="../assets/js/libs/sidebar-menu.js"></script>
  <script src="../assets/js/libs/apexcharts.min.js"></script>
  <script src="../assets/js/libs/sparkline.js"></script>
  <script src="../assets/js/libs/feather.min.js"></script>
  <script src="../assets/js/libs/chartist.min.js"></script>
  <script src="../assets/js/libs/peity.min.js"></script>
  <script src="../assets/js/libs/slick.min.js"></script>
  <script src="../assets/js/main.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
  const searchInput = document.getElementById('search');
  const searchBtn = document.getElementById('searchBtn');
  const tableBody = document.querySelector('table tbody');
  const prevPageBtn = document.getElementById('prevPage');
  const nextPageBtn = document.getElementById('nextPage');
  const currentPageDisplay = document.getElementById('currentPage');
  const totalPagesDisplay = document.getElementById('totalPages');

  let currentPage = 1;
  const itemsPerPage = 5; // Cambia esto según cuántos permisos quieras mostrar por página
  let totalPages = 1;
  let filteredData = [];
  let editingRow = null; // Definición de editingRow

  // Datos de ejemplo de los módulos y permisos
  const data = [
    { module: 'Configuración: Gestión de Roles', permissions: ['crearRol', 'modificarRol', 'cambiarEstadoRol', 'visualizarDetallesRol', 'eliminarRol', 'listarRoles', 'buscarRoles'] },
    { module: 'Usuarios: Gestión de Usuarios', permissions: ['crearUsuario', 'modificarUsuario', 'cambiarEstadoUsuario', 'visualizarDetallesUsuario', 'eliminarUsuario', 'listarUsuarios', 'buscarUsuarios'] },
    { module: 'Compras: Gestión de Productos', permissions: ['crearProducto', 'modificarProducto', 'cambiarEstadoProducto', 'visualizarDetallesProducto', 'eliminarProducto', 'listarProductos', 'buscarProductos'] },
    { module: 'Compras: Gestión de Proveedores', permissions: ['crearProveedor', 'modificarProveedor', 'cambiarEstadoProveedor', 'visualizarDetallesProveedor', 'eliminarProveedor', 'listarProveedores', 'buscarProveedores'] },
    { module: 'Compras: Gestión de Compras', permissions: ['crearCompra', 'modificarCompra', 'cambiarEstadoCompra', 'visualizarDetallesCompra', 'eliminarCompra', 'listarCompras', 'buscarCompras'] },
    { module: 'Ventas: Gestión de Clientes', permissions: ['crearCliente', 'modificarCliente', 'cambiarEstadoCliente', 'visualizarDetallesCliente', 'eliminarCliente', 'listarClientes', 'buscarClientes'] },
    { module: 'Ventas: Gestión del Carrito', permissions: ['crearCarrito', 'modificarCarrito', 'cambiarEstadoCarrito', 'visualizarDetallesCarrito', 'eliminarCarrito', 'listarCarritos', 'buscarCarritos'] },
    { module: 'Ventas: Gestión de Pedidos', permissions: ['crearPedido', 'modificarPedido', 'cambiarEstadoPedido', 'visualizarDetallesPedido', 'eliminarPedido', 'listarPedidos', 'buscarPedidos'] },
    { module: 'Ventas: Gestión de Ventas', permissions: ['crearVenta', 'modificarVenta', 'cambiarEstadoVenta', 'visualizarDetallesVenta', 'eliminarVenta', 'listarVentas', 'buscarVentas'] },
    { module: 'Ventas: Gestión de Devoluciones', permissions: ['crearDevolucion', 'modificarDevolucion', 'cambiarEstadoDevolucion', 'visualizarDetallesDevolucion', 'eliminarDevolucion', 'listarDevoluciones', 'buscarDevoluciones'] }
  ];

  // Función para renderizar los datos en la tabla
  function renderTable(page, data) {
    tableBody.innerHTML = '';
    const start = (page - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    const pageData = data.slice(start, end);

    pageData.forEach(item => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${item.module}</td>
        ${item.permissions.map(p => `<td><input type="checkbox" name="permiso" value="${p}"></td>`).join('')}
      `;
      tableBody.appendChild(row);
    });

    currentPageDisplay.textContent = currentPage;
    totalPagesDisplay.textContent = totalPages;

    // Deshabilitar botones si es primera o última página
    prevPageBtn.disabled = currentPage === 1;
    nextPageBtn.disabled = currentPage === totalPages;
  }

  // Función para calcular el total de páginas
  function calculateTotalPages(data) {
    totalPages = Math.ceil(data.length / itemsPerPage);
    totalPagesDisplay.textContent = totalPages;
  }

  // Función para buscar en la tabla
  function searchTable() {
    const searchText = searchInput.value.toLowerCase();
    filteredData = data.filter(item => 
      item.module.toLowerCase().includes(searchText) || 
      item.permissions.some(permission => permission.toLowerCase().includes(searchText))
    );
    currentPage = 1; // Reiniciar a la primera página después de la búsqueda
    calculateTotalPages(filteredData);
    renderTable(currentPage, filteredData);
  }

  // Eventos de paginación
  prevPageBtn.addEventListener('click', function () {
    if (currentPage > 1) {
      currentPage--;
      renderTable(currentPage, filteredData);
    }
  });

  nextPageBtn.addEventListener('click', function () {
    if (currentPage < totalPages) {
      currentPage++;
      renderTable(currentPage, filteredData);
    }
  });

  // Evento de búsqueda
  searchBtn.addEventListener('click', searchTable);

  // Renderiza la tabla inicial
  filteredData = data;
  calculateTotalPages(filteredData);
  renderTable(currentPage, filteredData);
});

// Manejo del formulario
document.getElementById('roleForm').addEventListener('submit', function (event) {
  event.preventDefault(); // Previene el envío del formulario

  const roleName = document.getElementById('roleName').value;
  const roleState = document.getElementById('roleState').value;
  const permissions = Array.from(document.querySelectorAll('#rolePermissions input:checked'))
    .map(checkbox => checkbox.value);

  if (!roleName || !roleState || permissions.length === 0) {
    Swal.fire('Error', 'Por favor, complete todos los campos.', 'error');
    return;
  }

  const isEditing = editingRow !== null;

  Swal.fire({
    title: isEditing ? '¿Desea guardar los cambios?' : '¿Desea crear el rol?',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Guardar',
    cancelButtonText: 'Cancelar'
  }).then((result) => {
    if (result.isConfirmed) {
      if (isEditing) {
        updateRoleInTable(roleName, roleState, permissions);
        Swal.fire('Éxito', 'Rol editado con éxito.', 'success');
      } else {
        addRoleToTable(roleName, roleState, permissions);
        Swal.fire('Éxito', 'Rol creado con éxito.', 'success');
      }
      document.getElementById('roleForm').reset();
      editingRow = null;
      document.getElementById('submitButton').textContent = 'Crear Rol'; // Restaurar el texto del botón
    }
  });
});

function addRoleToTable(roleName, roleState, permissions) {
  const tableBody = document.getElementById('rolesList');
  const row = document.createElement('tr');
  row.innerHTML = `
    <td>${roleName}</td>
    <td>${roleState}</td>
    <td data-permissions="${permissions.join(', ')}">
      <button class="btn btn-info btn-sm" onclick="viewRole(this)">Ver Detalles</button>
      <button class="btn btn-warning btn-sm" onclick="editRole(this)">Editar</button>
      <button class="btn btn-danger btn-sm" onclick="deleteRole(this)">Eliminar</button>
      <label class="switch">
        <input type="checkbox" ${roleState === 'activo' ? 'checked' : ''} onchange="changeRoleState(this)">
        <span class="slider"></span>
      </label>
    </td>
  `;
  tableBody.appendChild(row);
}

function updateRoleInTable(roleName, roleState, permissions) {
  if (editingRow) {
    editingRow.innerHTML = `
      <td>${roleName}</td>
      <td>${roleState}</td>
      <td data-permissions="${permissions.join(', ')}">
        <button class="btn btn-info btn-sm" onclick="viewRole(this)">Ver Detalles</button>
        <button class="btn btn-warning btn-sm" onclick="editRole(this)">Editar</button>
        <button class="btn btn-danger btn-sm" onclick="deleteRole(this)">Eliminar</button>
        <label class="switch">
          <input type="checkbox" ${roleState === 'activo' ? 'checked' : ''} onchange="changeRoleState(this)">
          <span class="slider"></span>
        </label>
      </td>
    `;
  }
}

function viewRole(button) {
  const row = button.closest('tr');
  const roleName = row.cells[0].innerText;
  const roleState = row.cells[1].innerText;
  const permissions = row.cells[2].getAttribute('data-permissions') || 'No asignados';

  Swal.fire({
    title: 'Detalles del Rol',
    html: `
      <p><strong>Nombre:</strong> ${roleName}</p>
      <p><strong>Permisos:</strong> ${permissions}</p>
      <p><strong>Estado:</strong> ${roleState}</p>
    `,
    icon: 'info'
  });
}

function editRole(button) {
  editingRow = button.closest('tr');
  const roleName = editingRow.cells[0].innerText;
  const roleState = editingRow.cells[1].innerText;
  const permissions = editingRow.cells[2].getAttribute('data-permissions').split(', ');

  document.getElementById('roleName').value = roleName;
  document.getElementById('roleState').value = roleState;
  permissions.forEach(permission => {
    const checkbox = document.querySelector(`#rolePermissions input[value="${permission}"]`);
    if (checkbox) checkbox.checked = true;
  });

  document.getElementById('submitButton').textContent = 'Guardar Cambios'; // Cambiar el texto del botón
}

function deleteRole(button) {
  const row = button.closest('tr');
  const roleName = row.cells[0].innerText;

  Swal.fire({
    title: '¿Estás seguro?',
    text: `No podrás recuperar el rol ${roleName} después de eliminarlo.`,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Eliminar',
    cancelButtonText: 'Cancelar'
  }).then((result) => {
    if (result.isConfirmed) {
      row.remove();
      Swal.fire('Eliminado', `Rol ${roleName} ha sido eliminado.`, 'success');
    }
  });
}

function changeRoleState(checkbox) {
  const row = checkbox.closest('tr');
  const roleName = row.cells[0].innerText;
  const state = checkbox.checked ? 'activo' : 'inactivo';

  Swal.fire({
    title: 'Cambiar Estado',
    text: `El rol ${roleName} se cambiará a ${state}.`,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Sí',
    cancelButtonText: 'No'
  }).then((result) => {
    if (result.isConfirmed) {
      row.cells[1].innerText = state; // Actualizar el estado en la tabla
      Swal.fire('Éxito', `Estado del rol ${roleName} cambiado a ${state}.`, 'success');
    } else {
      checkbox.checked = !checkbox.checked; // Restaurar el estado anterior
    }
  });
}

  </script>
</body>

</html>